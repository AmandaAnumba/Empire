{% extends "base_editor.html" %}
{% block content %}

<p id="id" hidden>{{ article.objectId }}</p>

<nav id="top_nav">
	<div id="back" class="pull-left">
		<a href="{{ url_for('review') }}">
			<span class="icon-arrow-left"></span> back to other articles
		</a>
	</div>

	{% if article.status == 'ready' %}
	<div class="pull-right padder">
		<div class="dropdown actions-tt" data-toggle="tooltip" data-placement="left" title="other actions">
            <div class="dropdown-toggle btn btn-default" style="background-color: #F2F2F2;" dropdown-toggle="actions" style="cursor: pointer;">
                <span class="icon icon-cog2"></span>
            </div>
            <ul class="dropdown-menu w-xs animated fadeInUp" id="actions">
                
                <li class="actions-tt" data-toggle="tooltip" data-placement="bottom" title="only save the changes you've made to this article"><a href="" onclick="save('ready');">Save Changes</a></li>
                
                <li class="divider"></li>
                
                <li class="actions-tt" data-toggle="tooltip" data-placement="bottom" title="delete this article"><a href="" onclick="$('#deleteModal').modal('show')">Delete Article</a></li>
                
                <li class="divider"></li>
                
                <li class="actions-tt" data-toggle="tooltip" data-placement="bottom" title="save the changes you've made and have someone review the article again" onclick="save('ready')"><a href="">Review Again</a></li>
            </ul>
        </div>
        
        <p id="finished" class="btn btn-primary" data-toggle="tooltip" data-placement="left" title="this article is ready to be published" onclick="$('#finishModal').modal('show')">Mark as Proofread</p>
	</div>

	{% else %} 
	<div class="pull-right padder">
        <p class="btn btn-default" data-toggle="tooltip" data-placement="left" title="delete this article" onclick="$('#deleteModal').modal('show');" style="background-color: #F5F5F5;">Delete Article</p>
		
		<p class="btn btn-primary" data-toggle="tooltip" data-placement="left" title="only save the changes you've made to this article" onclick="save('proofed');">Save Changes</p>
	</div>
	{% endif %}
</nav>

<section id="proof_wrapper">
	<div id="error_msg" class="alert error sticky animated fadeInDown" hidden>
	    <button type="button" class="close" data-dismiss="alert">
	        <span aria-hidden="true">&times;</span>
	        <span class="sr-only">Close</span>
	    </button>
	    <p class="message"></p>
	</div>

	<div id="success_msg" class="alert success sticky animated fadeInDown" hidden>
        <button type="button" class="close" data-dismiss="alert">
            <span aria-hidden="true">&times;</span>
            <span class="sr-only">Close</span>
        </button>
        <p class="message"></p>
    </div>

	<div id="startMSG" style="z-index:1000;" class="alert alert-info sticky animated fadeInDown" hidden>
	    <button type="button" class="close" data-dismiss="alert">
	        <span aria-hidden="true">&times;</span>
	        <span class="sr-only">Close</span>
	    </button>
	    <p class="message">You are now previewing the article in Inline Editing Mode. To edit a field, simply highlight the text and edit it.</p>
	</div>

	<form id="post" action="{{ url_for('submit') }}" accept-charset="UTF-8" method="POST" enctype="multipart/form-data">

		<section id="popouts_wrapper">
			<!-- uploaded media -->
			<div id="pop_uploads" class="popout-left" hidden>
				<header>Uploaded Media</header>

				<div class="popout_content">
					<p class="description" style="color:white;font-size: 0.8em;margin:0;">Copy the code and paste it into the document in the HTML view ( click <code><i class="fa fa-code"></i></code> in the text editor toolbar )</p>
					
				</div>

				<div id="uploads_toggle" class="slide_toggle-left" data-toggle="tooltip" data-placement="right" title="Uploaded Media"></div>
			</div>

			<!-- article settings -->
			<div id="pop_settings" class="popout">
				<header>Article Settings</header>

				<div class="popout_content">
					<p class="label">Change Category</p>
					<!-- <p class="sub-label">the main category this article falls under. Hold <code>Cmd</code> or <code>Ctrl</code> to select all major categories that apply. </p> -->
					<p class="sub-label">Current: <span id="current_cat">{{ article.category }}</span></p>
					<p class="btn btn-primary" id="catChange" onclick="catChange();">Change Categories</p>
					<select multiple class="clear-input-small2" id="category" name="category" hidden>
						<option>Politics</option>
						<option>Current Events</option>
						<option>Technology</option>
						<option>Money</option>
						<option>Body + Beauty</option>
						<option>Career</option>
						<option>Relationships</option>
						<option>Mind + Spirit</option>
						<option>Sports</option>
						<option>Arts + Fashion</option>
						<option>TV + Music</option>
						<option>Wildcard</option>
						<option>Inspire</option>
						<option>Rise</option>
						<option>Reign</option>
						<option>Cycle</option>
					</select>

					<!-- <select multiple class="clear-input-small2" id="category" name="category">
						<option>Politics</option>
						<option>Technology</option>
						<option>Money</option>
						<option>Body + Beauty</option>
						<option>Relationships</option>
						<option>Mind + Spirit</option>
						<option>Sports</option>
						<option>Arts + Fashion</option>
						<option>TV + Music</option>
						<option>Wildcard</option>
					</select> -->

					<p class="label">Add/Delete Tags</p>
					<input class="clear-input-small2" id="taginput" name="taginput" placeholder="separate, tags, with, commas" style="width:85%;" type="text" value="">

					<span class="doc-icon icon-circle-plus" id="add2list"></span>
					<div id="tags_list" style="display:block;"></div>
				</div>

				<div id="settings_toggle" class="slide_toggle" data-toggle="tooltip" data-placement="left" title="click to edit article's description and tags"></div>
			</div>

			<!-- article media -->
			<div id="pop_media" class="popout">
				<header>Media Uploads</header>
				
				<div class="popout_content">
					<p class="label">Feature Image</p>
					
					{% if article.featureIMG %}
	       	 		<p class="description" id="fIMG-des"> You have already uploaded a feature image</p>
	       	 		<img src="{{ article.featureIMG }}" alt="{{ article.title }}" id="fIMG" width="320" />
	       	 		
	       	 		<p class="btn btn-primary" id="changeIMG" onclick="changeIMG();">Change Image</p>

					<div id="change_image" hidden>
						<input class="clear-input-small2" id="featureIMG" name="featureIMG" type="file" accept="image/png,image/jpg,image/jpeg,image/gif">
						<p id="upload_btn2" class="btn btn-primary" hidden>Upload</p>
						<div id="progress2" hidden></div>
				        
				        <div class="response" id="success_upload2" style="text-align:center;" hidden><span style="color: #4CDBA5;" class="icon icon-check"></span></div>
				        
				        <div class="response" id="error_upload2" style="text-align:center;" hidden><span style="color: #FA626E;" class="icon icon-cross"></span></div>
					</div>

	       	 		{% else %}

					<p class="description" style="color:white;font-size: 0.75em;margin:0;">none selected. Please upload an image for this article.</p>

					<ul class="radio_btn clear-input-small3" id="media" placeholder="None" style="line-height: 0px !important;">
						<li>
							<input id="media-0" name="feature-media" type="radio" value="image" checked> 
							<label for="media-0">image/picture/gif</label>
						</li>
						<li class="video" data-toggle="tooltip" data-placement="top" title="video support coming soon!">
							<input id="media-2" name="feature-media" type="radio" value="video" disabled> 
							<label for="media-2">video</label>
						</li>
					</ul> 

					<input class="clear-input-small2" id="featureIMG" name="featureIMG" type="file" accept="image/png,image/jpg,image/jpeg,image/gif">
					<p id="upload_btn2" class="btn btn-primary" hidden>Upload</p>
					<div id="progress2" hidden></div>

			        <div class="response" id="success_upload2" style="text-align:center;" hidden><span style="color: #4CDBA5;" class="icon icon-check"></span></div>
			        
			        <div class="response" id="error_upload2" style="text-align:center;" hidden><span style="color: #FA626E;" class="icon icon-cross"></span></div>

			        {% endif %}

					<p class="label">Upload all other media</p>
					<p class="description" style="color:white;font-size: 0.75em;margin:0;">(upload files one at a time)</p>
					<ul class="radio_btn clear-input-small3" id="media" placeholder="None" style="line-height: 0px !important;">
						<li>
							<input id="media-0" name="media" type="radio" value="image" checked> 
							<label for="media-0">image/picture/gif</label>
						</li>
						<li class="video" data-toggle="tooltip" data-placement="top" title="video support coming soon!">
							<input id="media-2" name="media" type="radio" value="video" disabled> 
							<label for="media-2">video</label>
						</li>
					</ul>

					<input class="clear-input-small2" id="allmedia" name="allmedia" type="file" accept="image/png,image/jpg,image/jpeg,image/gif">
					<p id="upload_btn3" class="btn btn-primary"hidden >Upload</p>
					<div id="progress3" hidden></div>
			        
			        <div class="response" id="success_upload3" style="text-align:center;" hidden><span style="color: #4CDBA5;" class="icon icon-check"></span></div>
			        
			        <div class="response" id="error_upload3" style="text-align:center;" hidden><span style="color: #FA626E;" class="icon icon-cross"></span></div>
				</div>
				
				<div id="media_toggle" class="slide_toggle" data-toggle="tooltip" data-placement="left" title="click to upload article images"></div>
			</div>

			<!-- article release -->
			<div id="pop_review" class="popout">
				<header>Publishing</header>

				<div class="popout_content">
					<p class="label" for="doc-type">Change Article Type</p>
					<p class="sub-label">Current: {{ article.doctype }}</p>
					<ul class="radio_btn clear-input-small2" id="doctype" placeholder="None" style="line-height: 0px !important;">
						<li>
							<input id="doctype-0" name="doctype" type="radio" value="feature"> 
							<label for="doctype-0">feature</label>
						</li>
						<li>
							<input id="doctype-1" name="doctype" type="radio" value="regular"> 
							<label for="doctype-1">regular</label>
						</li>
						<li>
							<input id="doctype-2" name="doctype" type="radio" value="sponsored"> 
							<label for="doctype-2">sponsored</label>
						</li>
					</ul>

					<p class="label" for="doc-release">Change Release Date</p>
					<p id="date" class="sub-label">Current: <span id="rDate"></span></p>
					<input class="clear-input-small2" id="release" name="release" type="date">
				</div>
				
				<div id="review_toggle" class="slide_toggle" data-toggle="tooltip" data-placement="left" title="click to edit article type and publication date"></div>
			</div>
		</section>

		<section id="preview_header" style="text-align: center;">
			<div id="article_category">{{ article.category }}</div>

			<div class='clearfix'></div>
			
			{% if article.headerIMG %}
	        <img id="header_old" src="{{ article.headerIMG }}" alt="{{ article.title }}" width="650" />
		        
	        <div class="clearfix"></div>
	        
	        <input class="form-control" id="photo_cred_orig" name="photo_cred_orig" placeholder="Photo Credit" type="text" style="width:50%; margin: 10px auto;" value="{{ article.photoCred }}">

	        <p id="change_img" class="btn btn-default m">Change Header Image</p>

	        <div id="avi" hidden>
	            <div class="alert alert-info" style="width:400px; margin:0 auto;">
				    <button type="button" class="close" data-dismiss="alert">
				        <span aria-hidden="true">&times;</span>
				        <span class="sr-only">Close</span>
				    </button>
				    <p class="message">Note: If you do not upload a new header image, the original header image will be kept.</p>
				</div>

	            <p id="pic_icon">
	                <!-- <span class="icon-focus"></span> -->
	                <img id="avatar_pic" src="" alt="Article Header Image" width="650" style="margin-bottom:15px;" hidden />
	            </p>
	            
	            <input class="form-control" id="headerIMG" name="headerIMG" type="file" style="width:36%;margin: 12px auto;" accept="image/png,image/jpg,image/jpeg">
	    		
	    		<p id="upload_btn1" class="btn btn-primary" onclick="s3_upload($('#headerIMG').get(0).files[0].name, 'headerIMG')" style="display:none;">Upload Image to Server</p>
	    		
	    		<input class="form-control" id="photo_cred_new" name="photo_cred_new" placeholder="Photo Credit" type="text" style="width:50%; margin: 10px auto;">
	    		
	    		<div class="padder-v response" id="circle-progress" hidden></div>
		        
		        <div class="padder-v response" id="success_upload" hidden><span style="font-size:2.4em;color: #4CDBA5;" class="icon icon-check"></span><p><small>Image has been successfully uploaded!</small></p></div>
		        
		        <div class="padder-v response" id="error_upload" hidden><span style="font-size:2.4em;color: #FA626E;" class="icon icon-cross"></span><p><small>Image could not be uploaded. Please try again.</small></p></div>
		    </div>
	        
	        {% else %}  
			<section id="article-header-img" class="text-center">
				<p class="label2">Article Header Image</p>
				
				<p><small>** must be a large, hi-res image (at least 600px wide)</small></p>
		        <p id="pic_icon">
		        
		            <span class="icon-focus"></span>
		            <img id="avatar_pic" src="" alt="Profile Picture" width="600" style="margin-bottom:15px;" hidden />
		        </p>
		        
		        <input class="form-control" id="headerIMG" name="headerIMG" type="file" accept="image/png,image/jpg,image/jpeg">
		        
		        <input class="form-control" id="photo_cred_new" name="photo_cred" placeholder="Photo Credit" type="text" style="display:none; width:50%; margin-top:7px;">
		        
		        <p id="upload_btn1" class="btn btn-primary" onclick="s3_upload($('#headerIMG').get(0).files[0].name, 'headerIMG')" style="display:none;">Upload Image</p>
		        
		        <div class="padder-v response" id="circle-progress" hidden></div>
		        
		        <div class="padder-v response" id="success_upload" hidden><span style="font-size:2.4em;color: #4CDBA5;" class="icon icon-check"></span><p><small>Image has been successfully uploaded!</small></p></div>
		        
		        <div class="padder-v response" id="error_upload" hidden><span style="font-size:2.4em;color: #FA626E;" class="icon icon-cross"></span><p><small>Image could not be uploaded. Please try again.</small></p></div>
			</section>
	        {% endif %}

	    </section>

		<section id="article-data">
			<input class="clear-input-large" id="title" name="title" placeholder="Enter Title Here" type="text" value="{{ article.title }}">

			<textarea class="clear-input-small m-b-sm m-t-sm " name="description" placeholder="This will be displayed on the empire home page. Be brief." style="font-style: italic; height:auto;line-height:normal;">{{ article.description }}</textarea>

			<div class="pull-left" style="padding-left:0;">
				<input class="clear-input-med" id="author" name="author" placeholder="Author" type="text" value={{ article.author }} style="font-size: 1.1em;">
				
				{% if article.coAuthor %}
				<input class="clear-input-med" id="co-author" name="co-author" placeholder="username of co-author(s) separated by commas" type="text" style="width: 30%; font-size: 1.1em;" value={{ article.coAuthor }}>
				{% else %}
				<p id="add-author" class="description" style="color:indianred; cursor:pointer;margin:0;"><span class="icon icon-circle-plus" style="padding-right:15px;"></span> Add another author</p>
				<div id="more-authors" hidden>
					<input class="clear-input-med" id="co-author" name="co-author" placeholder="username of co-author(s) separated by commas" type="text" style="width: 30%;">
				</div>
				{% endif %}
			</div>


			<div class="pull-right">
				<div id="displayDate"></div>
			</div>

		</section>

		<div class="clearfix"></div>
		<div id="editor" style="margin-top: 30px;"></div>
	</form>

	<input type="hidden" name="featureIMGurl" value="{{ article.featureIMG }}">
	<input type="hidden" name="headerIMGurl" value="{{ article.headerIMG }}">
	<div id="text" hidden>{{ article.content }}</div>
	<div id="article_tags" hidden>{{ article.tags }}</div>
	<div id="article_type" hidden>{{ article.doctype }}</div>
	<div id="current_cat" hidden>{{ article.category }}</div>
	<div id="releaseDate" hidden>{{ article.releaseDate }}</div>
</section>

<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="text-align:center;">
                <h4>Are you sure you want to delete this article?</h4>
                <div>
                    <button type="button" class="btn btn-primary" id="yes" onclick="deletedraft();">Yeah, do it</button>
                    <button type="button" class="btn btn-default" style="background-color: #F2F2F2;" id="no" data-dismiss="modal">No, I changed my mind</button>   
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="finishModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style="text-align:center;text-align: left;font-style: normal;font-weight: 300;">
                <h2 class="thin text-center padder-v">Please ensure that the following details are correct before marking this article as proofread.</h2>
                <div id="finish_details">
                	<ul style="list-style-type:none;">
                		<li><strong>Title: </strong><span class="small" id="fTitle"></span></li>
                		<li><strong>Author: </strong><span class="small" id="fAuthor"></span></li>
                		<li><strong>Co-Author: </strong><span class="small" id="fCo"></span></li>
                		<li><strong>Article Type: </strong><span class="small" id="fType"></span></li>
                		<li><strong>Description: </strong><span class="small" id="fDescription"></span></li>
                		<li><strong>Category: </strong><span class="small" id="fCategory"></span></li>
                		<li><strong>Release Date: </strong><span class="small" id="fRelease"></span></li>
                		<li hidden id="dateForRelease"></li>
                		<li><strong>Tags: </strong><span class="small" id="fTags"></span></li>
                		<li><strong>Written Content: </strong><span class="small" id="fContent"></span></li>
                		<li><strong>Header Image: </strong><span class="small" id="fHeader"></span></li>
                		<li><strong>Photo Cred: </strong><span class="small" id="fPhotoCred"></span></li>
                		<li><strong>Feature Image: </strong><span class="small" id="fFeature"></span></li>
                	</ul>
                </div>
                <div class='text-center'>
                    <button type="button" class="btn btn-primary" id="proofBTN" onclick="proofed();">Yes, Mark as Proofread</button>
                    <button type="button" class="btn btn-default" style="background-color: #F2F2F2;" data-dismiss="modal">Continue Editing</button>   
                </div>
            </div>
        </div>
    </div>
</div>

<script>
	$(function() {
		$('.slide_toggle, .btn, .actions-tt').tooltip();
		$('.dropdown-menu').dropdown()

		$('#editor').editable({
			inlineMode: true, 
			minHeight: 500,
			placeholder: 'The article\'s content will be displayed here',
			spellcheck: true,
			buttons: ["bold", "italic", "underline", "strikeThrough", "fontSize","fontFamily", "color",'sep',"subscript", "superscript", "formatBlock", "blockStyle", "align", "insertOrderedList", "insertUnorderedList", "outdent", "indent", 'sep', "selectAll", "createLink", "undo", "removeFormat", "redo", "html", "insertHorizontalRule", "table"]
		});

		if (!Modernizr.inputtypes.date) {
		    $('input[type=date]').datepicker({
		        // Consistent format with the HTML5 picker
		        dateFormat: 'yy-mm-dd'
		    });
		}

		$('#editor').editable("setHTML", $('#text').text(), true);


		var release = $('#releaseDate').text(),
			category = $('#article_category').text(),
			tags = $('#article_tags').text().split(','),
			doctype = $('#article_type').text();

		if (doctype) {
			$("input[name=doctype][value=" + doctype + "]").prop('checked', true);
		}

		if ((release === 'None') || (release === null) || (release === "")) {
			$('#rDate').empty().append('No date selected');
		}

		if ((release !== 'None') && (release !== null) && (release !== "")) {
			var y = release.split(','),
				date = moment(y).format("dddd, MMMM Do YYYY");
			$('#rDate, #displayDate').empty().append(date);
		}

		if (category) {
			var x = category.split(',');
			$('#article_category').empty();

			for (var i = 0; i < x.length; i++) {
				$('#article_category').append('<p class="pull-left">'+x[i].trim()+'</p>');
			}
		}

		for (var i=0; i < tags.length; i++) {
			if (tags[i]) {
				$('#tags_list').append('<p><span class="icon-circle-cross remove_tag" onclick="$(this).parent().hide();"></span>'+tags[i].trim()+'</p>');
			}
		}

		setTimeout("jQuery('#startMSG').show();", 2000);
		setTimeout("jQuery('#startMSG').hide();", 4700);
	});
</script>
{% endblock %}